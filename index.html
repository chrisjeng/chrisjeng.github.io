<html>
<body>
<script src="pixi.js"></script>
<script src="sound.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.3.min.js"><\/script>')</script>
<script>

  var level = 0;
  var foodCount = 0;
  var hungerTimeElapsed = 0;
  var loveTimeElapsed = 0;
  var width = 640;
  var height = 480;
  var chickenWeight = 50;
  var chickenLove = 50;
  var hungerSeconds = 0;
  var loveSeconds = 0;
  var stage = new PIXI.Container();

  // Initialize textures
  var characterTexture = PIXI.Texture.fromImage('assets/img/chicken/chicken2_mouth_closed.png');
  var foodTexture = PIXI.Texture.fromImage('assets/img/food/fries.png');

  // init heart/hunger textures
  var heart0 = PIXI.Texture.fromImage('assets/img/heart/heart0.png');
  var heart25 = PIXI.Texture.fromImage('assets/img/heart/heart25.png');
  var heart50 = PIXI.Texture.fromImage('assets/img/heart/heart50.png');
  var heart75 = PIXI.Texture.fromImage('assets/img/heart/heart75.png');
  var heart100 = PIXI.Texture.fromImage('assets/img/heart/heart100.png');
  var hunger0 = PIXI.Texture.fromImage('assets/img/hunger/hunger0.png');
  var hunger25 = PIXI.Texture.fromImage('assets/img/hunger/hunger25.png');
  var hunger50 = PIXI.Texture.fromImage('assets/img/hunger/hunger50.png');
  var hunger75 = PIXI.Texture.fromImage('assets/img/hunger/hunger75.png');
  var hunger100 = PIXI.Texture.fromImage('assets/img/hunger/hunger100.png');

  var food_fries = PIXI.Texture.fromImage('assets/img/food/fries.png')
  var food_hamburger = PIXI.Texture.fromImage('assets/img/food/hamburger.png')
  var food_hotdog = PIXI.Texture.fromImage('assets/img/food/hotdog.png')
  var food_onigiri = PIXI.Texture.fromImage('assets/img/food/onigiri.png')
  var food_pringle = PIXI.Texture.fromImage('assets/img/food/pringle.png')

  // Create background and renderer for image
  var renderer = PIXI.autoDetectRenderer(width, height,{backgroundColor : 0x81D4FA});
  document.body.appendChild(renderer.view);
  var grass = new PIXI.Graphics();
  grass.beginFill(0x00C853);
  grass.drawRect(0, height - 0.3 * height, width, 0.3 * height);
  grass.endFill();
  stage.addChild(grass);
  var line = new PIXI.Graphics();
  line.lineStyle(4, 0x000000, 1);
  line.moveTo(0, 0);
  line.lineTo(width, 0);
  line.x = 0;
  line.y = height - 0.3 * height;
  stage.addChild(line);


  // Load the sounds
  sounds.load([
    "assets/sound/bite.mp3",
  ]);

  // Callback function for when sounds have been loaded
  sounds.whenLoaded = setupSounds;

  // Initialize sounds here
  var bite;
  function setupSounds() {
    bite = sounds["assets/sound/bite.mp3"];
  }

  // create a texture from an image path
  var foods = [];
  var chicken = new PIXI.Sprite(characterTexture);
  chicken.anchor.x = 0.0;
  chicken.anchor.y = 0.0;
  chicken.position.x = 0.3 * width;
  chicken.position.y = 0.3 * height;
  chicken.scale.x = 0.42;
  chicken.scale.y = 0.42;
  chicken.interactive = true;
  chicken.buttonMode = true;
  // set up dragging for chicken
  chicken.on('mousedown', onDragStart)
    .on('touchstart', onDragStart)
    // events for drag end
    .on('mouseup', onDragEnd)
    .on('mouseupoutside', onDragEnd)
    .on('touchend', onDragEnd)
    .on('touchendoutside', onDragEnd)
    // events for drag move
    .on('mousemove', onDragMove)
    .on('touchmove', onDragMove);
  stage.addChild(chicken);
  var score = 0;
  var text = new PIXI.Text(score, {font : '24px Arial', fill : 0x000000, align : 'center'});
  stage.addChild(text);

  // display the heart logo at 100%
  var heartTexture = heart50;
  var heart = new PIXI.Sprite(heartTexture);

  // hard coded values
  heart.height = 50;
  heart.width = 50;
  heart.anchor.x = 0.5;
  heart.anchor.y = 0.5;
  heart.position.x = 0.875 * width;
  heart.position.y = 0.6 * height;
  stage.addChild(heart);

  // display the hunger logo at 100%
  var hungerTexture = hunger50;
  var hunger = new PIXI.Sprite(hungerTexture);

  // hard coded values
  hunger.height = 50;
  hunger.width = 50;
  hunger.anchor.x = 0.5;
  hunger.anchor.y = 0.5;
  hunger.position.x = 0.875 * width;
  hunger.position.y = 0.8 * height;
  stage.addChild(hunger);

  $(renderer.view).mousedown(function(e) {
    var x = e.offsetX;
    var y = e.offsetY;
    var food = new PIXI.Sprite(foodTexture);
    food.scale.x = 0.15;
    food.scale.y = 0.15;
    food.position.x = x;
    food.position.y = y;
    foods.push(food);
    stage.addChild(food);
  });

  // start animating
  animate();
  function animate() {
    hungerSeconds = ++hungerTimeElapsed/60;
    loveSeconds = ++loveTimeElapsed/60;
    requestAnimationFrame(animate);
    checkFoodPositions();
    checkTimeElapsed(hungerSeconds, loveSeconds);
    text.text = score;
    // render the container
    renderer.render(stage);
  }

  function checkTimeElapsed(hungerSeconds, loveSeconds) {
    // if no action has been taken on hunger, make chicken skinnier
    if (hungerSeconds > 2.5) {
      updateChickenWeight(-5);
    }
    if(loveSeconds > 2.5){
      decreaseChickenLove();
    }

    // if no action has been taken on love, update the chicken love
  }

  function checkFoodPositions() {
    for (var i = 0; i < foods.length; i++) {
      foods[i].position.y += 3;
      if (foods[i].position.y > 600) {
        removeFood(foods[i]);
      }
      else if (checkCollision(chicken, foods[i])) {
        removeFood(foods[i]);
        bite.play();
        if (++foodCount == 2) {
          updateChickenWeight(5);
          foodCount = 0;
          seconds = 0;
        }
        score++;
      }
    }
  }

  // resizes chicken based on hunger and love
  function resizeChicken(weight) {
    switch(weight) {
      case 0:
        // dead
        console.log(weight);
        break;
      case 10:
        console.log(weight);
        break;
      case 20:
        console.log(weight);
        break;
      case 30:
        console.log(weight);
        break;
      case 40:
        console.log(weight);
        break;
      case 50:
        console.log(weight);
        break;
      case 60:
        console.log(weight);
        break;
      case 70:
        console.log(weight);
        break;
      case 80:
        console.log(weight);
        break;
      case 90:
        console.log(weight);
        break;
      case 100:
        console.log(weight);
        break;
      default:
        console.log(weight);
        break;
    }
  }

  function removeFood(food) {
    stage.removeChild(food);
    i = foods.indexOf(food);
    foods.splice(i, 1);
  }

  // Returns you a random Pixi sprite of food.
  function getRandomFood() {
    rand = 0;
    switch(rand) {
      case 0:
        return new PIXI.Sprite(food_fries)
    }
    return null;
  }

  function checkCollision(a, b) {
    return !(b.position.x > (a.position.x + a.width) ||
            (b.position.x + b.width) < a.position.x ||
             b.position.y > (a.position.y + a.height) ||
            (b.position.y + b.height) < a.position.y);
  }

  // updates chicken weight with the given value! aka feed chicken
  function updateChickenWeight(foodValue){
    chickenWeight += foodValue;
    if(chickenWeight > 100){
      chickenWeight = 100;
    }
    resizeChicken(chickenWeight);
    setHungerLevel(chickenWeight);
    hungerTimeElapsed = 0;
  }

  // replaces the hunger icon with the appropriate icon
  function setHungerLevel(hungerLevel) {
    if(hungerLevel == 0){
      hunger.texture = hunger0;
    } else if(hungerLevel > 0 && hungerLevel < 25){
      hunger.texture = hunger25;
    } else if(hungerLevel >= 25 && hungerLevel < 50) {
      hunger.texture = hunger50;
    } else if(hungerLevel >= 50 && hungerLevel < 75){
      hunger.texture = hunger75;
    } else if(hungerLevel >= 75 && hungerLevel <= 100){
      hunger.texture = hunger100;
    }
  }

  // replaces the love icon with the appropriate icon
  function setLoveIcon(loveLevel) {
    if(loveLevel == 0){
      heart.texture = heart0;
    } else if(loveLevel > 0 && loveLevel < 25){
      heart.texture = heart25;
    } else if(loveLevel >= 25 && loveLevel < 50) {
      heart.texture = heart50;
    } else if(loveLevel >= 50 && loveLevel < 75){
      heart.texture = heart75;
    } else if(loveLevel >= 75 && loveLevel <= 100){
      heart.texture = heart100;
    }
  }

  // function called when user pets chicken
  function increaseChickenLove() {
    if(chickenLove > 0 && chickenLove <= 30){
      chickenLove += .75;
    }
    else if(chickenLove > 30 && chickenLove <= 50){
      chickenLove += .5;
    }
    else if(chickenLove > 50){
      chickenLove += .25;
    }
    if(chickenLove > 100){
      chickenLove = 100;
    }
  }

  function decreaseChickenLove() {
    loveTimeElapsed = 0;
    chickenLove += -5;
    setLoveIcon(chickenLove);
  }

  // petting event listener
  function onDragStart(event) {
    // store a reference to the data
    this.data = event.data;
    this.dragging = true;
  }

  function onDragEnd() {
    this.dragging = false;
    // set the interaction data to null
    this.data = null;
    console.log(chickenLove);
  }

  // on drag, check to see if mouse is still colliding w/ chicken
  function onDragMove() {
    if (this.dragging)
    {
      var mousePosition = this.data.getLocalPosition(this.parent);
      if(checkMouseCollision(mousePosition, chicken)) {
        console.log("petpetpet");
        increaseChickenLove();
      }
    }
  }

  // function used to check if sprite collides with mouse
  // pass mouse in as first parameter
  function checkMouseCollision(a, b){
    return !(b.position.x > a.x ||
            (b.position.x + b.width) < a.x ||
             b.position.y > a.y ||
            (b.position.y + b.height) < a.y);
  }
</script>
</body>
</html
