<html>
<head>
  <link rel="stylesheet" type="text/css" href="assets/style.css" />
</head>
<body>
<script src="assets/js/pixi.js"></script>
<script src="assets/js/sound.js"></script>
<script src="assets/js/fbinstant.js"></script>
<script src="assets/js/jquery.min.js"></script>
<script>

  function Chicken() {
    this.foodCount = 0;
    this.hungerTimeElapsed = 0;
    this.loveTimeElapsed = 0;
    this.chickenWeight = 50;
    this.chickenLove = 50;
    // petting event listener
    var onDragStart = function(event) {
      // store a reference to the data
      this.data = event.data;
      this.dragging = true;
    }

    var onDragEnd = function() {
      this.dragging = false;
      // set the interaction data to null
      this.data = null;
      console.log(chicken.chickenLove);
    }

    // on drag, check to see if mouse is still colliding w/ chicken
    var onDragMove = function() {
      if (this.dragging)
      {
        var mousePosition = this.data.getLocalPosition(this.parent);
        if(checkMouseCollision(mousePosition, chicken.bodySprite)) {
          console.log("petpetpet");
          chicken.increaseChickenLove();
        }
      }
    }
    // resizes chicken based on hunger and love
    this.resizeChicken = function(weight) {
      switch(weight) {
        case 0:
          // dead
          console.log(weight);
          break;
        case 10:
          console.log(weight);
          break;
        case 20:
          console.log(weight);
          break;
        case 30:
          console.log(weight);
          break;
        case 40:
          console.log(weight);
          break;
        case 50:
          console.log(weight);
          break;
        case 60:
          console.log(weight);
          break;
        case 70:
          console.log(weight);
          break;
        case 80:
          console.log(weight);
          break;
        case 90:
          console.log(weight);
          break;
        case 100:
          console.log(weight);
          break;
        default:
          console.log(weight);
          break;
      }
    }

    // updates chicken weight with the given value! aka feed chicken
    this.updateChickenWeight = function(foodValue){
      this.chickenWeight += foodValue;
      if(this.chickenWeight > 100){
        this.chickenWeight = 100;
      }
      this.resizeChicken(this.chickenWeight);
      this.hungerTimeElapsed = 0;
    }

    // function called when user pets chicken
    this.increaseChickenLove = function() {
      if(this.chickenLove > 0 && this.chickenLove <= 30){
        this.chickenLove += .75;
      }
      else if(this.chickenLove > 30 && this.chickenLove <= 50){
        this.chickenLove += .5;
      }
      else if(this.chickenLove > 50){
        this.chickenLove += .25;
      }
      if(this.chickenLove > 100){
        this.chickenLove = 100;
      }
    }

    this.decreaseChickenLove = function() {
      this.loveTimeElapsed = 0;
      this.chickenLove += -5;
    }
    this.bodySprite = new PIXI.Sprite(characterTexture);
    this.bodySprite.anchor.x = 0.0;
    this.bodySprite.anchor.y = 0.0;
    this.bodySprite.position.x = 0.3 * width;
    this.bodySprite.position.y = 0.3 * height;
    this.bodySprite.scale.x = 0.42;
    this.bodySprite.scale.y = 0.42;
    this.bodySprite.interactive = true;
    this.bodySprite.buttonMode = true;
    // set up dragging for chicken
    this.bodySprite.on('mousedown', onDragStart)
      .on('touchstart', onDragStart)
      // events for drag end
      .on('mouseup', onDragEnd)
      .on('mouseupoutside', onDragEnd)
      .on('touchend', onDragEnd)
      .on('touchendoutside', onDragEnd)
      // events for drag move
      .on('mousemove', onDragMove)
      .on('touchmove', onDragMove);
  }

  var level = 0;
  var width = 640;
  var height = 480;
  var ticks = 0;
  var hungerSeconds = 0;
  var loveSeconds = 0;
  var stage = new PIXI.Container();

  // Initialize textures
  var characterTexture = PIXI.Texture.fromImage('assets/img/chicken/chicken2_black.png');
  var foodTexture = PIXI.Texture.fromImage('assets/img/food/fries.png');
  var barnTexture = PIXI.Texture.fromImage('assets/img/background/barn.png');
  var cloudTexture = PIXI.Texture.fromImage('assets/img/background/cloud3.png');

  // init heart/hunger textures
  var heart0 = PIXI.Texture.fromImage('assets/img/heart/heart0.png');
  var heart25 = PIXI.Texture.fromImage('assets/img/heart/heart25.png');
  var heart50 = PIXI.Texture.fromImage('assets/img/heart/heart50.png');
  var heart75 = PIXI.Texture.fromImage('assets/img/heart/heart75.png');
  var heart100 = PIXI.Texture.fromImage('assets/img/heart/heart100.png');
  var hunger0 = PIXI.Texture.fromImage('assets/img/hunger/hunger0.png');
  var hunger25 = PIXI.Texture.fromImage('assets/img/hunger/hunger25.png');
  var hunger50 = PIXI.Texture.fromImage('assets/img/hunger/hunger50.png');
  var hunger75 = PIXI.Texture.fromImage('assets/img/hunger/hunger75.png');
  var hunger100 = PIXI.Texture.fromImage('assets/img/hunger/hunger100.png');

  var food_fries = PIXI.Texture.fromImage('assets/img/food/fries.png')
  var food_hamburger = PIXI.Texture.fromImage('assets/img/food/hamburger.png')
  var food_hotdog = PIXI.Texture.fromImage('assets/img/food/hotdog.png')
  var food_onigiri = PIXI.Texture.fromImage('assets/img/food/onigiri.png')
  var food_pringle = PIXI.Texture.fromImage('assets/img/food/pringle.png')

  // Create background and renderer for image
  var renderer = PIXI.autoDetectRenderer(width, height,{backgroundColor : 0x81D4FA});
  document.body.appendChild(renderer.view);

  var grass = new PIXI.Graphics();
  grass.beginFill(0x00C853);
  grass.drawRect(0, height - 0.3 * height, width, 0.3 * height);
  grass.endFill();
  stage.addChild(grass);

  var line = new PIXI.Graphics();
  line.lineStyle(4, 0x000000, 1);
  line.moveTo(0, 0);
  line.lineTo(width, 0);
  line.x = 0;
  line.y = height - 0.3 * height;
  stage.addChild(line);

  var barn = new PIXI.Sprite(barnTexture);
  barn.scale.set(0.2, 0.2);
  barn.position.x = 0.05 * width;
  barn.position.y = 0.455 * height;
  stage.addChild(barn);

  var cloud = new PIXI.Sprite(cloudTexture);
  cloud.scale.set(0.25, 0.25);
  cloud.position.x = width * 0.05;
  cloud.position.y = height * 0.05;
  stage.addChild(cloud);

  var cloud2 = new PIXI.Sprite(cloudTexture);
  cloud2.scale.set(0.10, 0.10);
  cloud2.position.x = width * 0.45;
  cloud2.position.y = height * 0.04;
  stage.addChild(cloud2);

  var cloud3 = new PIXI.Sprite(cloudTexture);
  cloud3.scale.set(0.2, 0.2);
  cloud3.position.x = width * 0.6;
  cloud3.position.y = height * 0.09;
  stage.addChild(cloud3);


  // Load the sounds
  sounds.load([
    "assets/sound/bite.mp3",
  ]);

  // Callback function for when sounds have been loaded
  sounds.whenLoaded = setupSounds;

  // Initialize sounds here
  var bite;
  function setupSounds() {
    bite = sounds["assets/sound/bite.mp3"];
  }

  // create a texture from an image path
  var foods = [];
  var chicken = new Chicken()
  stage.addChild(chicken.bodySprite);
  var score = 0;
  var text = new PIXI.Text(score, {font : '24px Arial', fill : 0x000000, align : 'center'});
  stage.addChild(text);

  // display the heart logo at 100%
  var heartTexture = heart100;
  var heart = new PIXI.Sprite(heartTexture);

  // hard coded values
  heart.height = 90;
  heart.width = 90;
  heart.anchor.x = 0.5;
  heart.anchor.y = 0.5;
  heart.position.x = 0.87 * width;
  heart.position.y = 0.15 * height;
  stage.addChild(heart);

  // display the hunger logo at 100%
  var hungerTexture = hunger100;
  var hunger = new PIXI.Sprite(hungerTexture);

  // hard coded values
  hunger.height = 90;
  hunger.width = 90;
  hunger.anchor.x = 0.5;
  hunger.anchor.y = 0.5;
  hunger.position.x = 0.87 * width;
  hunger.position.y = 0.37 * height;
  stage.addChild(hunger);

  var food = getRandomFood();

  $(renderer.view).mousedown(function(e) {
    var x = e.offsetX;
    var y = e.offsetY;
    // food.scale.x = 0.12;
    // food.scale.y = 0.12;
    food.position.x = x;
    food.position.y = y;
    foods.push(food);
    stage.addChild(food);
    food = getRandomFood();
  });

  // start animating
  animate();
  function animate() {
    ++ticks;
    if (ticks % 60 == 0) {
      runOnceASecond();
    }
    hungerSeconds = ++chicken.hungerTimeElapsed/60;
    loveSeconds = ++chicken.loveTimeElapsed/60;
    requestAnimationFrame(animate);
    updateFoodMovementPositions();
    checkTimeElapsed(hungerSeconds, loveSeconds);
    text.text = score;
    // render the container
    renderer.render(stage);
  }

  // This function runs once a second
  function runOnceASecond() {
    // Put your every-second job in here.
  }

  function checkTimeElapsed(hungerSeconds, loveSeconds) {
    // if no action has been taken on hunger, make chicken skinnier
    if (hungerSeconds > 2.5) {
      chicken.updateChickenWeight(-5);
      setHungerLevel(chicken.chickenWeight);
    }
    if(loveSeconds > 2.5){
      chicken.decreaseChickenLove();
      setLoveIcon(chicken.chickenLove);
    }

    // if no action has been taken on love, update the chicken love
  }

  function updateFoodMovementPositions() {
    for (var i = 0; i < foods.length; i++) {
      foods[i].position.y += 3;
      if (foods[i].position.y > height) {
        removeFood(foods[i]);
      }
      else if (checkCollision(chicken.bodySprite, foods[i])) {
        removeFood(foods[i]);
        bite.play();
        if (++chicken.foodCount == 2) {
          chicken.updateChickenWeight(5);
          setHungerLevel(chicken.chickenWeight);
          chicken.foodCount = 0;
          seconds = 0;
        }
        score++;
      }
    }
  }


  function removeFood(food) {
    stage.removeChild(food);
    i = foods.indexOf(food);
    foods.splice(i, 1);
  }

  // Gets you a random number between min and max
  function randomNumber(min, max) {
    return Math.floor(Math.random() * (1 + max - min) + min);
	}

  // Returns you a random Pixi sprite of food.
  function getRandomFood() {
    rand = randomNumber(0, 4);
    switch(rand) {
      case 0:
        return getFries();
      case 1:
        return getHamburger();
      case 2:
        return getHotdog();
      case 3:
        return getOnigiri();
      case 4:
        return getPringle();
    }
    return "Should not reach this point in getRandomFood!";
  }

  function checkCollision(a, b) {
    return !(b.position.x > (a.position.x + a.width) ||
            (b.position.x + b.width) < a.position.x ||
             b.position.y > (a.position.y + a.height) ||
            (b.position.y + b.height) < a.position.y);
  }


  // replaces the hunger icon with the appropriate icon
  function setHungerLevel(hungerLevel) {
    if(hungerLevel == 0){
      hunger.texture = hunger0;
    } else if(hungerLevel > 0 && hungerLevel < 25){
      hunger.texture = hunger25;
    } else if(hungerLevel >= 25 && hungerLevel < 50) {
      hunger.texture = hunger50;
    } else if(hungerLevel >= 50 && hungerLevel < 75){
      hunger.texture = hunger75;
    } else if(hungerLevel >= 75 && hungerLevel <= 100){
      hunger.texture = hunger100;
    }
  }

  // replaces the love icon with the appropriate icon
  function setLoveIcon(loveLevel) {
    if(loveLevel == 0){
      heart.texture = heart0;
    } else if(loveLevel > 0 && loveLevel < 25){
      heart.texture = heart25;
    } else if(loveLevel >= 25 && loveLevel < 50) {
      heart.texture = heart50;
    } else if(loveLevel >= 50 && loveLevel < 75){
      heart.texture = heart75;
    } else if(loveLevel >= 75 && loveLevel <= 100){
      heart.texture = heart100;
    }
  }



  // function used to check if sprite collides with mouse
  // pass mouse in as first parameter
  function checkMouseCollision(a, b){
    return !(b.position.x > a.x ||
            (b.position.x + b.width) < a.x ||
             b.position.y > a.y ||
            (b.position.y + b.height) < a.y);
  }

  // food functions that return a properly sized food sprite
  function getPringle() {
    var pringle = new PIXI.Sprite(food_pringle);
    pringle.scale.x = .2;
    pringle.scale.y = .2;
    return pringle;
  }

  function getFries() {
    var fries = new PIXI.Sprite(food_fries);
    fries.scale.x = .12;
    fries.scale.y = .12;
    return fries;
  }

  function getHamburger() {
    var hamburger = new PIXI.Sprite(food_hamburger);
    hamburger.scale.x = .1;
    hamburger.scale.y = .1;
    return hamburger;
  }

  function getHotdog() {
    var hotdog = new PIXI.Sprite(food_hotdog);
    hotdog.scale.x = .15;
    hotdog.scale.y = .15;
    return hotdog;
  }

  function getOnigiri() {
    var onigiri = new PIXI.Sprite(food_onigiri);
    onigiri.scale.x = .1;
    onigiri.scale.y = .1;
    return onigiri;
  }
</script>
</body>
</html
